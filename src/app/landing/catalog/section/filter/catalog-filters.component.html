<!-- catalog-filters.component.html -->
<div class="offcanvas-lg offcanvas-start pe-lg-4" id="filterSidebar">
  <div class="offcanvas-header py-3">
    <h5 class="offcanvas-title">Filter products</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#filterSidebar" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body flex-column pt-2 py-lg-0">

    <!-- Categories -->
    <div class="accordion pb-2" id="categories" *ngIf="categories.length > 0">

      <!-- Dynamic Categories -->
      <div class="accordion-item border-0 mb-3" *ngFor="let category of categories; let i = index">
        <h4 class="accordion-header" [id]="'heading-' + createSafeId(category.name)">
          <button type="button" 
                  class="accordion-button collapsed p-0" 
                  data-bs-toggle="collapse" 
                  [attr.data-bs-target]="'#' + createSafeId(category.name)" 
                  aria-expanded="false" 
                  [attr.aria-controls]="createSafeId(category.name)">
            <span class="d-flex align-items-center justify-content-center bg-body-secondary rounded-circle me-3" style="width: 56px; height: 56px">
              <img [src]="category.image_url || 'assets/cartzilla/img/shop/grocery/categories/0' + ((i % 7) + 1) + '.png'" 
                   width="40" 
                   [alt]="category.name">
            </span>
            <span class="fs-sm">{{category.name}}</span>
          </button>
        </h4>
        <div class="accordion-collapse collapse" 
             [id]="createSafeId(category.name)" 
             [attr.aria-labelledby]="'heading-' + createSafeId(category.name)" 
             data-bs-parent="#categories">
          <div class="accordion-body ps-4 pb-0">
            <ul class="nav flex-column gap-2 border-start px-4 pb-1 ms-1 mb-0">
              <li class="nav-item pb-1 ps-3 ms-1">
                <a class="nav-link hover-effect-underline fw-normal p-0" 
                   [routerLink]="['/shop-category', category.id]" 
                   >
                  Shop all {{category.name}}
                </a>
              </li>
              <li class="nav-item pb-1 ps-3 ms-1" *ngFor="let child of category.children || []">
                <a class="nav-link hover-effect-underline fw-normal p-0" 
                   [routerLink]="['/catalog']" 
                   [queryParams]="{category: child.id}">
                  {{child.name}}
                </a>
              </li>
              <li class="nav-item pb-1 ps-3 ms-1" *ngIf="!(category.children && category.children.length > 0)">
                <a class="nav-link hover-effect-underline fw-normal p-0 text-body-tertiary" href="javascript:void(0)">
                  No subcategories available
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State for Categories -->
    <div *ngIf="loading" class="text-center py-3">
      <div class="spinner-border spinner-border-sm text-primary" role="status">
        <span class="visually-hidden">Loading categories...</span>
      </div>
      <p class="mt-2 text-body-secondary">Loading categories...</p>
    </div>

    <!-- Filters -->
    <div class="accordion border-top mb-4">

      <!-- Price -->
      <div class="accordion-item">
        <h4 class="accordion-header" id="headingPrice">
          <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#price" aria-expanded="false" aria-controls="price">
            Price
          </button>
        </h4>
        <div class="accordion-collapse collapse" id="price" aria-labelledby="headingPrice">
          <div class="accordion-body">
            <div class="range-slider ps-1" 
                 data-range-slider='{"startMin": 1, "startMax": 30, "min": 0, "max": 100, "step": 1, "tooltipPrefix": "$"}' 
                 aria-labelledby="headingPrice">
              <div class="range-slider-ui"></div>
              <div class="d-flex align-items-center">
                <div class="position-relative w-50">
                  <i class="ci-dollar-sign position-absolute top-50 start-0 translate-middle-y ms-3"></i>
                  <input type="number" 
                         class="form-control form-icon-start" 
                         min="0" 
                         [(ngModel)]="selectedPriceRange.min"
                         (change)="onPriceChange()"
                         data-range-slider-min>
                </div>
                <i class="ci-minus text-body-emphasis mx-2"></i>
                <div class="position-relative w-50">
                  <i class="ci-dollar-sign position-absolute top-50 start-0 translate-middle-y ms-3"></i>
                  <input type="number" 
                         class="form-control form-icon-start" 
                         min="0" 
                         [(ngModel)]="selectedPriceRange.max"
                         (change)="onPriceChange()"
                         data-range-slider-max>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Brand -->
      <div class="accordion-item">
        <h4 class="accordion-header" id="headingBrand">
          <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#brand" aria-expanded="false" aria-controls="brand">
            Brand
          </button>
        </h4>
        <div class="accordion-collapse collapse" id="brand" aria-labelledby="headingBrand">
          <div class="accordion-body">
            <div class="position-relative mb-3">
              <i class="ci-search position-absolute top-50 start-0 translate-middle-y ms-3"></i>
              <input type="search" class="form-control form-icon-start" placeholder="Search brands">
            </div>
            <div style="height: 210px" data-simplebar data-simplebar-auto-hide="false">
              <div class="d-flex flex-column gap-2">
                <div class="form-check mb-0" *ngFor="let brand of brands">
                  <input type="checkbox" 
                         class="form-check-input" 
                         [id]="'brand-' + brand.id"
                         [checked]="selectedBrands.includes(brand.id)"
                         (change)="onBrandChange(brand.id, $event)">
                  <label [for]="'brand-' + brand.id" class="form-check-label text-body-emphasis">
                    {{brand.name}}
                  </label>
                </div>
                <div class="text-center text-body-secondary py-2" *ngIf="brands.length === 0">
                  No brands available
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Special diet -->
      <div class="accordion-item">
        <h4 class="accordion-header" id="headingDiet">
          <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#diet" aria-expanded="false" aria-controls="diet">
            Special diet needs
          </button>
        </h4>
        <div class="accordion-collapse collapse" id="diet" aria-labelledby="headingDiet">
          <div class="accordion-body">
            <div class="d-flex flex-column gap-2">
              <div class="form-check mb-0">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="gluten-free"
                       [checked]="selectedDiets.includes('gluten-free')"
                       (change)="onDietChange('gluten-free', $event)">
                <label for="gluten-free" class="form-check-label text-body-emphasis">Gluten-free</label>
              </div>
              <div class="form-check mb-0">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="plant-based"
                       [checked]="selectedDiets.includes('plant-based')"
                       (change)="onDietChange('plant-based', $event)">
                <label for="plant-based" class="form-check-label text-body-emphasis">Plant based</label>
              </div>
              <div class="form-check mb-0">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="vegan"
                       [checked]="selectedDiets.includes('vegan')"
                       (change)="onDietChange('vegan', $event)">
                <label for="vegan" class="form-check-label text-body-emphasis">Vegan</label>
              </div>
              <div class="form-check mb-0">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="keto"
                       [checked]="selectedDiets.includes('keto')"
                       (change)="onDietChange('keto', $event)">
                <label for="keto" class="form-check-label text-body-emphasis">Keto diet</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status -->
      <div class="accordion-item">
        <h4 class="accordion-header" id="headingStatus">
          <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#status" aria-expanded="false" aria-controls="status">
            Status
          </button>
        </h4>
        <div class="accordion-collapse collapse" id="status" aria-labelledby="headingStatus">
          <div class="accordion-body">
            <div class="d-flex flex-column gap-2">
              <div class="form-check mb-0">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="instock"
                       [checked]="selectedStatus.includes('instock')"
                       (change)="onStatusChange('instock', $event)">
                <label for="instock" class="form-check-label text-body-emphasis">In stock</label>
              </div>
              <div class="form-check mb-0">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="sale"
                       [checked]="selectedStatus.includes('sale')"
                       (change)="onStatusChange('sale', $event)">
                <label for="sale" class="form-check-label text-body-emphasis">% Sale</label>
              </div>
              <div class="form-check mb-0">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="delivery"
                       [checked]="selectedStatus.includes('delivery')"
                       (change)="onStatusChange('delivery', $event)">
                <label for="delivery" class="form-check-label text-body-emphasis">Free delivery</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Clear Filters Button -->
    <div class="d-grid mb-4">
      <button type="button" 
              class="btn btn-outline-secondary" 
              (click)="clearFilters()"
              [disabled]="selectedBrands.length === 0 && selectedDiets.length === 0 && selectedStatus.length === 0">
        Clear All Filters
      </button>
    </div>

    <!-- Banner -->
    <div class="rounded-4 overflow-hidden" style="background-color: #a6cddc" data-bs-theme="light">
      <div class="pt-3 px-3 mt-3 mx-3">
        <h4 class="mb-2 mb-xl-3">Make breakfast healthy and easy</h4>
        <div class="nav">
          <a class="nav-link animate-underline stretched-link px-0" href="#!">
            <span class="animate-target">Shop now</span>
            <i class="ci-chevron-right fs-base mt-1 ms-1"></i>
          </a>
        </div>
      </div>
      <div class="ratio mt-n2" style="--cz-aspect-ratio: calc(240 / 282 * 100%)">
        <img src="assets/cartzilla/img/shop/grocery/banner.jpg" alt="Banner">
      </div>
    </div>
  </div>
</div>